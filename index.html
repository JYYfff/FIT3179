<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIT3179 Week 10 – Interactive Visualisation</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; background:#f7fbff; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p.hint { margin: 6px 0 18px; color:#334155; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 24px; }
    .card { background: #ffffff; border-radius: 14px; box-shadow: 0 6px 18px rgba(2,12,27,0.06); padding: 18px; }
    .card h2 { margin: 0 0 10px; font-size: 18px; }
    .note { font-size: 12px; color:#475569; margin-top: 6px; }
    .controls { display:flex; flex-wrap:wrap; gap:12px; margin:10px 0 0; }
    label { font-size: 13px; color:#334155; }
  </style>
</head>
<body>
  <h1>FIT3179 Week 10 – Interactive Visualisation</h1>
  <p class="hint">This page contains two Vega-Lite visualisations: your Week 9 map (baseline) and the enhanced Week 10 interactive map (with tooltip, annotation, and filtering).</p>

  <div class="grid">
    <div class="card">
      <h2>Original Map (Week 9)</h2>
      <div id="vis-original"></div>
      <div class="note">Baseline proportional symbol map of Australian capital cities and their populations.</div>
    </div>

    <div class="card">
      <h2>Enhanced Interactive Map (Week 10)</h2>
      <div id="vis-interactive"></div>
      <div class="note">Includes: Tooltip ✔︎, Text Annotation ✔︎, Filtering (state dropdown & population slider) ✔︎.</div>
    </div>
  </div>

  <script>
    const baseSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 800,
      "height": 520,
      "background": "#eaf6ff",
      "config": {"view": {"stroke": null}},
      "projection": {"type": "equalEarth", "center": [133, -28], "scale": 850},
      "layer": [
        {"data": {"graticule": true}, "mark": {"type": "geoshape", "stroke": "#c4d7e6", "strokeWidth": 0.5, "filled": false}},
        {"data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@2.12.1/data/world-110m.json", "format": {"type": "topojson", "feature": "countries"}}, "mark": {"type": "geoshape", "fill": "#f9fbff", "stroke": "#b7c5d6", "strokeWidth": 0.6}},
        {
          "data": {"values": [
            {"city": "Sydney", "state": "NSW", "lat": -33.8688, "lon": 151.2093, "pop_millions": 5.3},
            {"city": "Melbourne", "state": "VIC", "lat": -37.8136, "lon": 144.9631, "pop_millions": 5.2},
            {"city": "Brisbane", "state": "QLD", "lat": -27.4698, "lon": 153.0251, "pop_millions": 2.7},
            {"city": "Perth", "state": "WA", "lat": -31.9523, "lon": 115.8613, "pop_millions": 2.2},
            {"city": "Adelaide", "state": "SA", "lat": -34.9285, "lon": 138.6007, "pop_millions": 1.4},
            {"city": "Canberra", "state": "ACT", "lat": -35.2809, "lon": 149.13, "pop_millions": 0.47},
            {"city": "Hobart", "state": "TAS", "lat": -42.8821, "lon": 147.3272, "pop_millions": 0.24},
            {"city": "Darwin", "state": "NT", "lat": -12.4634, "lon": 130.8456, "pop_millions": 0.15}
          ]},
          "mark": {"type": "circle", "tooltip": true, "opacity": 0.9},
          "encoding": {
            "longitude": {"field": "lon", "type": "quantitative"},
            "latitude": {"field": "lat", "type": "quantitative"},
            "size": {"field": "pop_millions", "type": "quantitative", "title": "Population (millions)", "scale": {"range": [50, 2200]}},
            "color": {"field": "pop_millions", "type": "quantitative", "title": "Population (millions)"},
            "tooltip": [
              {"field": "city", "title": "City"},
              {"field": "state", "title": "State/Territory"},
              {"field": "pop_millions", "title": "Population (M)", "format": ".2f"}
            ]
          }
        },
        {
          "data": {"values": [
            {"city": "Sydney", "state": "NSW", "lat": -33.8688, "lon": 151.2093, "pop_millions": 5.3},
            {"city": "Melbourne", "state": "VIC", "lat": -37.8136, "lon": 144.9631, "pop_millions": 5.2},
            {"city": "Brisbane", "state": "QLD", "lat": -27.4698, "lon": 153.0251, "pop_millions": 2.7},
            {"city": "Perth", "state": "WA", "lat": -31.9523, "lon": 115.8613, "pop_millions": 2.2},
            {"city": "Adelaide", "state": "SA", "lat": -34.9285, "lon": 138.6007, "pop_millions": 1.4},
            {"city": "Canberra", "state": "ACT", "lat": -35.2809, "lon": 149.13, "pop_millions": 0.47},
            {"city": "Hobart", "state": "TAS", "lat": -42.8821, "lon": 147.3272, "pop_millions": 0.24},
            {"city": "Darwin", "state": "NT", "lat": -12.4634, "lon": 130.8456, "pop_millions": 0.15}
          ]},
          "mark": {"type": "text", "dy": -10, "fontSize": 11},
          "encoding": {"longitude": {"field": "lon", "type": "quantitative"}, "latitude": {"field": "lat", "type": "quantitative"}, "text": {"field": "city"}, "color": {"value": "#1f2937"}}
        }
      ],
      "title": {"text": "Australian Capital Cities by Estimated Population (Demo Data)", "anchor": "start", "fontSize": 16}
    };

    // ORIGINAL (Week 9)
    const specOriginal = baseSpec;

    // ENHANCED (Week 10): add params (dropdown + slider), filters, and an annotation layer for the top city.
    const specInteractive = JSON.parse(JSON.stringify(baseSpec));

    // Add parameters for filtering
    specInteractive.params = [
      {
        name: "stateSel",
        value: "All",
        bind: { input: "select", options: ["All","ACT","NSW","NT","QLD","SA","TAS","VIC","WA"], labels: ["All","ACT","NSW","NT","QLD","SA","TAS","VIC","WA"] }
      },
      {
        name: "minPop",
        value: 0.0,
        bind: { input: "range", min: 0, max: 6, step: 0.1 }
      }
    ];

    // Inject transform filters to the circle layer (index 2 in the layers array)
    specInteractive.layer[2].transform = [
      { filter: "(stateSel === 'All') || (datum.state === stateSel)" },
      { filter: "datum.pop_millions >= minPop" }
    ];

    // Add a bold stroke to selected points (optional aesthetic)
    specInteractive.layer[2].mark.stroke = "#0f172a";
    specInteractive.layer[2].mark.strokeWidth = 0.6;

    // Add an annotation layer: highlight the top city by population with a label
    const annotationLayer = {
      data: { values: baseSpec.layer[2].data.values },
      transform: [
        { window: [{ op: "rank", as: "r" }], sort: [{ field: "pop_millions", order: "descending" }] },
        { filter: "datum.r === 1" }
      ],
      layer: [
        {
          mark: { type: "circle", stroke: "#111827", strokeWidth: 1.2, fill: "#fff", size: 400 },
          encoding: {
            longitude: { field: "lon", type: "quantitative" },
            latitude: { field: "lat", type: "quantitative" }
          }
        },
        {
          mark: { type: "text", dy: -18, fontSize: 12, fontWeight: "bold", background: "#ffffff" },
          encoding: {
            longitude: { field: "lon", type: "quantitative" },
            latitude: { field: "lat", type: "quantitative" },
            text: { field: "city", type: "nominal" }
          }
        },
        {
          mark: { type: "text", dy: -34, fontSize: 11 },
          encoding: {
            longitude: { field: "lon", type: "quantitative" },
            latitude: { field: "lat", type: "quantitative" },
            text: { value: "Highest population" },
            color: { value: "#1f2937" }
          }
        }
      ]
    };

    specInteractive.layer.push(annotationLayer);

    // Update title with interaction hints
    specInteractive.title = {
      text: "Australian Capital Cities – Interactive (Filter & Annotation)",
      subtitle: [
        "Use the dropdown to filter by state and the slider to set minimum population (millions)."
      ],
      anchor: "start",
      fontSize: 16
    };

    vegaEmbed('#vis-original', specOriginal, { actions: false });
    vegaEmbed('#vis-interactive', specInteractive, { actions: false });
  </script>
</body>
</html>

